generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  
}

/* =========================
   ENUMS (STRICT STATES)
========================= */

enum Role {
  USER        // Job seeker
  EMPLOYER    // Can post jobs
  ADMIN       // Platform admin
}

enum JobType {
  FULL_TIME
  PART_TIME
  INTERN
  CONTRACT
  REMOTE
}

enum JobStatus {
  DRAFT       // Created but not visible
  OPEN        // Accepting applications
  PAUSED      // Temporarily hidden
  CLOSED      // No longer accepting
}

enum WorkMode {
  REMOTE
  HYBRID
  ONSITE
}

enum ApplicationStatus {
  APPLIED
  REVIEWING
  SHORTLISTED
  REJECTED
  HIRED
}

enum WorkStatus {
  EXPERIENCED
  FRESHER
}

enum CompanyType {
  CORPORATE
  FOREIGN_MNC
  STARTUP
  INDIAN_MNC
  GOVT
  OTHERS
}

/* =========================
   USER (AUTH CORE)
========================= */

model User {
  id            String   @id @default(uuid())
  email         String   @unique
  passwordHash  String
  role          Role     @default(USER)
  mobileNumber  String?
  workStatus    WorkStatus?
  isActive      Boolean  @default(true)
  emailVerified Boolean  @default(false)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  profile        Profile?
  jobPreference  JobPreference?
  company        Company?
  applications   Application[]
  sessions       Session[]
  savedJobs      SavedJob[]

  @@index([role])
}

/* =========================
   AUTH SESSIONS
========================= */

model Session {
  id        String   @id @default(uuid())
  sessionToken String   @unique
  userId    String
  expires   DateTime
  createdAt DateTime @default(now())

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

/* =========================
   JOB SEEKER PROFILE
========================= */

model Profile {
  id              String    @id @default(uuid())
  userId          String    @unique
  fullName        String
  headline        String?
  bio             String?
  profileSummary  String?
  resumeHeadline  String?
  skills          String[]
  experience      Int       // years
  resumeUrl       String?
  avatarUrl       String?
  linkedinUrl     String?
  githubUrl       String?
  portfolioUrl    String?
  college         String?
  degree          String?
  currentCompany  String?
  location        String?
  currentLocation String?
  mobile          String?
  email           String?
  availability    String?
  dob             DateTime?
  gender          String?
  maritalStatus   String?
  languages       String[]
  careerBreak     Boolean   @default(false)
  differentlyAbled Boolean   @default(false)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user         User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  education    Education[]
  employment   Employment[]
  projects     Project[]
  certificates Certificate[]
}

model Education {
  id        String   @id @default(uuid())
  degree    String
  college   String
  stream    String?
  startYear Int?
  endYear   Int?
  isFullTime Boolean @default(true)

  profileId String
  profile   Profile @relation(fields: [profileId], references: [id], onDelete: Cascade)

  @@index([profileId])
}

model Employment {
  id          String  @id @default(uuid())
  designation String
  company     String
  location    String?
  startYear   Int?
  endYear     Int?
  isCurrent   Boolean @default(false)
  description String?

  profileId String
  profile   Profile @relation(fields: [profileId], references: [id], onDelete: Cascade)

  @@index([profileId])
}

model Project {
  id           String    @id @default(uuid())
  title        String
  description  String?
  role         String?
  projectLink  String?
  startDate    DateTime?
  endDate      DateTime?

  profileId String
  profile   Profile @relation(fields: [profileId], references: [id], onDelete: Cascade)

  @@index([profileId])
}

model Certificate {
  id        String    @id @default(uuid())
  name      String
  issuer    String?
  issueDate DateTime?
  url       String?

  profileId String
  profile   Profile @relation(fields: [profileId], references: [id], onDelete: Cascade)

  @@index([profileId])
}

model JobPreference {
  id                String    @id @default(uuid())
  userId            String    @unique
  locations         String[]
  titles            String[]
  expectedSalaryMin Int?
  expectedSalaryMax Int?
  workModes         WorkMode[]

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
}

/* =========================
   COMPANY (EMPLOYER)
========================= */

model Company {
  id          String      @id @default(uuid())
  name        String
  description String
  website     String?
  location    String?
  logoUrl     String?
  isVerified  Boolean     @default(false)
  type        CompanyType @default(STARTUP)
  size        String?

  ownerId   String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  owner User @relation(fields: [ownerId], references: [id], onDelete: Cascade)
  jobs  Job[]

  @@index([name])
  @@index([type])
}

/* =========================
   JOB POSTING
========================= */

model Job {
  id          String    @id @default(uuid())
  title       String
  description String
  location    String
  jobType     JobType
  status      JobStatus @default(DRAFT)
  workMode    WorkMode  @default(ONSITE)
  degree      String?

  salaryMin   Int?
  salaryMax   Int?
  experience  Int?      // years

  companyId String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  company      Company       @relation(fields: [companyId], references: [id], onDelete: Cascade)
  applications Application[]
  savedJobs    SavedJob[]

  @@index([status])
  @@index([jobType])
  @@index([workMode])
  @@index([location])
  @@index([salaryMin, salaryMax])
}

/* =========================
   JOB APPLICATION
========================= */

model Application {
  id        String             @id @default(uuid())
  jobId     String
  userId    String
  status    ApplicationStatus  @default(APPLIED)
  coverNote String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  job  Job  @relation(fields: [jobId], references: [id], onDelete: Cascade)
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([jobId, userId])
}

/* =========================
   SAVED JOBS
========================= */

model SavedJob {
  id        String   @id @default(uuid())
  userId    String
  jobId     String
  createdAt DateTime @default(now())

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
  job  Job  @relation(fields: [jobId], references: [id], onDelete: Cascade)

  @@unique([userId, jobId])
  @@index([userId])
  @@index([jobId])
}
